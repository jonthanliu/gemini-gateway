# 系统模式

## 架构概述

`gemini-gateway` 采用基于 Next.js 的全栈架构，分为两个主要部分：

1.  **API 网关 (`/app/(api)`)**：处理所有传入的 AI 请求。这是系统的核心，负责认证、路由、请求/响应转换和日志记录。
2.  **管理界面 (`/app/(web)`)**：一个受密码保护的 Web 应用程序，允许管理员配置网关、管理 API 密钥和查看日志。

这种分离的结构使得 API 的高性能需求和管理界面的复杂交互可以独立开发和扩展。

## 关键设计模式

1.  **适配器模式**：

    - **位置**：`lib/adapters/`
    - **描述**：这是实现 API 转换的核心。为每个（源 API -> 目标 API）的组合创建一个适配器（例如 `openai-to-gemini.ts`）。每个适配器负责将请求格式从源转换为目标，并将响应格式从目标转换回源。
    - **优点**：将转换逻辑封装起来，使得添加对新模型或新 API 格式的支持变得简单，只需添加新的适配器即可。

2.  **中间件模式**：

    - **位置**：`middleware.ts`
    - **描述**：用于处理国际化（i18n）路由和可能的全局请求预处理。
    - **优点**：在请求到达 API 路由处理程序之前，集中处理跨领域的关注点。

3.  **服务层模式**：

    - **位置**：`lib/services/`
    - **描述**：将核心业务逻辑（如数据库操作）从 API 路由处理程序中分离出来。例如，`key.service.ts` 封装了所有与 API 密钥相关的数据库交互。
    - **优点**：提高了代码的可重用性和可测试性，并使 API 路由处理程序更简洁，只关注请求和响应的协调。

4.  **环境变量配置**：
    - **位置**：`.env.example`, `lib/config/envConfig.ts`
    - **描述**：通过环境变量来管理所有敏感信息和环境特定的配置。`envConfig.ts` 提供类型安全的访问方式。
    - **优点**：安全地管理配置，避免将敏感数据硬编码到代码中，并方便在不同环境（开发、生产）中部署。
