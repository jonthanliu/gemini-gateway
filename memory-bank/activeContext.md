# 当前上下文

## 当前工作焦点

- **任务**: 增强的日志和分析。
- **状态**: 进行中。

## 近期变更

- **模型映射重构**:
  - **数据库**: 将 `model_mappings` 表中的 `target_endpoint` 字段重构为类型安全的 `target_method` 枚举 (`generateContent` | `streamGenerateContent`)。
  - **UI**: 更新了管理界面的映射表单，使用下拉菜单选择 `target_method`。同时，在表格中禁止了删除 `__DEFAULT__` 规则，并在编辑表单中禁止了修改其名称。
  - **API 路由**: 修改了 OpenAI 和 Anthropic 的 API 路由，使其流式/非流式行为完全由数据库中的 `target_method` 配置驱动。
  - **版本控制**: 将所有相关的代码更改组织到三个独立的、有意义的 Git 提交中。

## 下一步

- **增强的日志和分析**:
  - **目标**: 在管理仪表盘中提供更详细的 API 调用统计和分析图表。
  - **初步计划**:
    1.  分析现有日志数据结构 (`requestLogs`)，确定可以聚合哪些指标（例如，按模型、按密钥、按时间段的调用次数、成功率、平均延迟）。
    2.  设计新的数据库查询或服务层方法来聚合这些统计数据。
    3.  规划新的 UI 组件来展示这些图表（可能会使用一个图表库）。

## 重要模式和偏好

- **文档优先**: 在开始编码之前，确保相关的记忆库文档已经建立或更新。
- **原子化提交**: 倾向于小而集中的 Git 提交，每个提交都与一个明确的任务相关联。
